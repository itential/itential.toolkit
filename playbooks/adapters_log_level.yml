# Copyright (c) 2023, Itential, LLC
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)
---
- name: Adapters log level
  hosts: platform
  gather_facts: false
  vars:
    ansible_connection: local
  roles:
    - auth_token
  tasks:

    - name: Validate log level input
      ansible.builtin.fail:
        msg: "Invalid log level selected. Please choose one of: error, warn, info, debug, trace, spam."
      when: log_level not in ['error', 'warn', 'info', 'debug', 'trace', 'spam']

    - name: Normalize adapters string to list
      ansible.builtin.set_fact:
        adapters: ["{{ adapters }}"]
      when: adapters is string

    - name: Debug adapters
      ansible.builtin.debug:
        var: adapters

    - name: Set log level for adapters
      itential.platform.set_adapter_log_level:
        adapter_name: "{{ item }}"
        log_level: "{{ log_level }}"
        transport: file
      loop: "{{ adapters }}"
      loop_control:
        loop_var: item

    - name: Restart adapters
      itential.platform.restart_adapters:
        adapter_names: "{{ adapters }}"
