# Copyright (c) 2023, Itential, LLC
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)
---
# Example usage:
# ansible-playbook -i hosts mongo_dump.yml -e "db=itential collection=workflows"
- name: Mongodump
  hosts: mongodb
  gather_facts: false
  tasks:

    - name: Dump all collections
      ansible.builtin.command: >
        mongodump -u {{ mongo_username }} -d {{ db }} -p {{ mongo_password }}
        --authenticationDatabase={{ mongo_auth_db }}
      when: collection is undefined
      changed_when: false

    - name: Dump single collection
      ansible.builtin.command: >
        mongodump -u {{ mongo_username }} -d {{ db }} -p {{ mongo_password }}
        --authenticationDatabase={{ mongo_auth_db }} -c {{ collection }}
      when: collection is defined
      changed_when: false
