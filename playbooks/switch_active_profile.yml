# Copyright (c) 2023, Itential, LLC
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)
---
# Example usage:
# ansible-playbook -i switch_active_profile.yml

- name: Switch Active Profile
  hosts: platform
  gather_facts: true
  become: true

  tasks:
    - name: Switch active Profile
      itential.platform.generic_request:
        method: PUT
        endpoint: "/profiles/{{ id }}/active"
      register: status_response

    - name: Display the response
      ansible.builtin.debug:
        msg:
          - "{{ switch_profile_response.json }}"

    - name: Restart platform
      ansible.builtin.include_role:
        name: itential.toolkit.restart_platform
        tasks_from: restart
      when: switch_profile_response.status == 200
